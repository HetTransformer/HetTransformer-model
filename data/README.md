# Data Collection and Pre-processing
This folder contains code for collecting the datasets and pre-processing them.

## Data Collection
The instructions for collecting PolitiFact, GossipCop, and PHEME datasets are described in the [README.md](https://github.com/HetTransformer/HetTransformer-model#1-dataset-collection) in the root directory. Please finish them first.
* `compute_statistics_fakenewsnet.py` computes the statistics for your collection of PolitiFact and GossipCop datasets.
* `deduplication_fakenewsnet.py` serves as an extension to [FakeNewsNet](https://github.com/KaiDMML/FakeNewsNet) by extracting the previously failed requests from the log files to avoid sending duplicated data collection requests.

## Image fetching and encoding
* `fetch_fakenewsnet_img.py` is used to collect the images attached in news content in PolitiFact and GossipCop datasets.
* `fetch_fakenewsnet_img_multiproc.py` is used to collect the images attached in news content in PolitiFact and GossipCop datasets with multiple workers.
* `visual_feature_extractor.py` uses pre-trained ResNet 18 to extract the viusal features from the images attached in news content. This function is used for PolitiFact and GossipCop. We feed in a white image if there's no image attached in news of PolitiFact and GossipCop datasets. All the news in PHEME dataset does not have images, so this function does not apply to PHEME. 

## Graph constuction and random walk with restarts
* `generate_graph_fakenewsnet.py` generates the graph input needed from PolitiFact and GossipCop datasets for `random_walk_with_restart.py` with multi-processing.
* `generate_graph_pheme.py` generates the graph input needed from PHEME dataset for `random_walk_with_restart.py` with multi-processing.
* `compute_statistics.py` computes the statistics of the graph generated by `generate_graph_fakenewsnet.py` and `generate_graph_pheme.py`.
* `random_walk_with_restart.py` performs _random walk with restarts_ (RWR) for PolitiFact, GossipCop and PHEME with multi-processing.

## Text encoding
* `text_embedder.py` defines a Transformer-based text embedder for all text embedding.
* `embed_text_fakenewsnet.py` embeds the text for all types of nodes in PolitiFact and GossipCop datasets with `text_embedder.py` with multi-processing.
* `embed_text_pheme.py` embeds the text for all types of nodes in PHEME datasets with `text_embedder.py` with multi-processing.

## Other features
* `get_fnn_post_features.py` extracts the numeric and catagorical features of all posts in PolitiFact and GossipCop datasets.
* `get_fnn_user_features.py` extracts the numeric and catagorical features of all users in PolitiFact and GossipCop datasets.
* `get_fnn_news_labels.py` extracts the news labels of news in PolitiFact and GossipCop datasets.
* `get_pheme_news_features.py` extracts the numeric and catagorical features of all news in PHEME dataset.
* `get_pheme_user_features.py` extracts the numeric and catagorical features of all user in PHEME dataset.
* `get_pheme_news_labels.py` extracts the news labels of all news in PHEME dataset.

## Create input dataset
* `news_nodes_pheme.py` contains the function to combine all news features (e.g., the embedding for news content and news image, news label) and to create the news nodes input for PHEME dataset. 
* `post_nodes_pheme.py` contains the function to combine all post features (e.g., the embedding for post content, neighbor lists) and to create the news nodes input for PHEME dataset. 
* `user_nodes_pheme.py` contains the function to combine all user features (e.g., the embedding for user description, user characteristics) and to create the news nodes input for PHEME dataset. 
* `pheme_dataset.py` contains the main function to call all the nodes-creating functions mentioned above.
* `news_nodes_fnn.py` contains the function to combine all news features (e.g., the embedding for news content and news image, news label) and to create the news nodes input for PolitiFact and GossipCop dataset. 
* `post_nodes_fnn.py` contains the function to combine all post features (e.g., the embedding for post content, neighbor lists) and to create the news nodes input for PolitiFact and GossipCop dataset. 
* `user_nodes_fnn.py` contains the function to combine all user features (e.g., the embedding for user description, user characteristics) and to create the news nodes input for PolitiFact and GossipCop dataset. 
* `fnn_dataset.py` contains the main function to call all the nodes-creating functions mentioned above.
